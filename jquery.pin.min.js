(function(a){a.fn.pin=function(c){var g=0,f=[],d=false,h=a(window);c=c||{};var e=function(){for(var l=0,j=f.length;l<j;l++){var o=f[l];if(c.minWidth&&h.width()<=c.minWidth){if(o.parent().is(".pin-wrapper")){o.unwrap()}o.css({width:"",left:"",top:"",position:""});if(c.activeClass){o.removeClass(c.activeClass)}d=true;continue}else{d=false}o.css({width:"",left:"",top:"",position:""});var q=c.containerSelector?o.closest(c.containerSelector):a(document.body);var p=o.offset();var m=q.offset();var k=o.offsetParent().offset();if(!o.parent().is(".pin-wrapper")){o.wrap('<div class="pin-wrapper">')}var n=a.extend({top:0,bottom:0},c.padding||{});o.data("pin",{pad:n,from:(c.containerSelector?m.top:p.top)-n.top,to:m.top+q.height()-o.outerHeight()-n.bottom,end:m.top+q.height(),parentTop:k.top});o.css({width:o.outerWidth()});o.parent().css("height",o.outerHeight())}};var b=function(){if(d){return}g=h.scrollTop();var l=[];for(var k=0,j=f.length;k<j;k++){var n=a(f[k]),m=n.data("pin");if(!m){continue}l.push(n);var p=m.from-m.pad.bottom,o=m.to-m.pad.top;if(p+n.outerHeight()>m.end){n.css("position","");continue}if(p<g&&o>g){!(n.css("position")==="fixed")&&n.css({left:n.offset().left,top:m.pad.top}).css("position","fixed");if(c.activeClass){n.addClass(c.activeClass)}}else{if(g>=o){n.css({left:"",top:o-m.parentTop+m.pad.top}).css("position","absolute");if(c.activeClass){n.addClass(c.activeClass)}}else{n.css({position:"",top:"",left:""});if(c.activeClass){n.removeClass(c.activeClass)}}}}f=l};var i=function(){e();b()};this.each(function(){var k=a(this),j=a(this).data("pin")||{};if(j&&j.update){return}f.push(k);a("img",this).one("load",e);j.update=i;a(this).data("pin",j)});h.scroll(b);h.resize(function(){e()});e();h.load(i);return this}})(jQuery);
